/*
 * Title                   : Hotspotter Editor App
 * Author                  : Basem "z-B"
 * Version                 : 2.0.1
 * Last Modified           : 22-08-2020
 * CodeCanyon Profile      : http://codecanyon.net/user/z-B
 */
var Draw={$edImg:null,edImg_b:{t:0,b:0,l:0,r:0},parentOffset:{x:0,y:0},mouseCoord:{x:0,y:0},isDraw:!1,type:"red-spot",init:function(a){function b(){setTimeout(function(){Draw.$edImg.bind("mousedown.draw",$.proxy(Draw.mousedown,Draw)),$(document).bind("mousemove.draw",$.proxy(Draw.start,Draw)),$(document).bind("mouseup.draw",$.proxy(Draw.mouseup,Draw))},100)}this.$edImg=a,this.$edImg.unbind(".draw"),$(document).unbind(".draw"),this.$edImg[0].complete?b():this.$edImg.bind("load.draw",b)},getConstraints:function(){this.edImg_b.t=this.$edImg.offset().top,this.edImg_b.b=this.$edImg.offset().top+this.$edImg.height(),this.edImg_b.l=this.$edImg.offset().left,this.edImg_b.r=this.$edImg.offset().left+this.$edImg.width(),this.parentOffset.x=this.$edImg.parent().offset().left,this.parentOffset.y=this.$edImg.parent().offset().top},mousedown:function(a){if(this.getConstraints(),1===a.which){if("sniper-spot"===this.type)return a.pageX<this.parentOffset.x+this.$edImg.width()-11&&a.pageY<this.parentOffset.y+this.$edImg.height()-11&&Editor.newSpot(new Spot(this.type,a.pageX-this.parentOffset.x-11,a.pageY-this.parentOffset.y-11)),!1;if("img-spot"===this.type)return Editor.newSpot(new Spot(this.type,a.pageX-this.parentOffset.x,a.pageY-this.parentOffset.y)),$("#img-spot-dialog").dialog("open"),!1;this.isDraw=!0,this.mouseCoord.x=a.pageX,this.mouseCoord.y=a.pageY}return!1},start:function(a){if(this.isDraw){this.curSpot||(this.curSpot=new Spot(this.type,this.mouseCoord.x-this.parentOffset.x,this.mouseCoord.y-this.parentOffset.y));var b=10,c=10;a.pageX>this.edImg_b.l&&(a.pageX-this.mouseCoord.x>10&&(c=a.pageX-this.mouseCoord.x),a.pageX>this.edImg_b.r&&(c=this.$edImg.width()-parseFloat(this.curSpot.$edSpot.css("left"))),this.curSpot.$edSpot.outerWidth(c)),a.pageY>this.edImg_b.t&&(a.pageY-this.mouseCoord.y>10&&(b=a.pageY-this.mouseCoord.y),a.pageY>this.edImg_b.b&&(b=this.$edImg.height()-parseFloat(this.curSpot.$edSpot.css("top"))),this.curSpot.$edSpot.outerHeight(b))}},mouseup:function(){this.isDraw=!1,this.curSpot&&(Editor.newSpot(this.curSpot),Editor.updateSpotDim(),Editor.updateSpotPos(),this.curSpot=null)}},Spot=function(a,b,c){if(this.spotClass=a,"sniper-spot"===a){var d=$("<div/>").addClass(a);this.$edSpot=$("<div/>").css("position","absolute").css("left",b).css("top",c).data("spotObj",this).append(d).appendTo(Editor.$edDiv)}else this.$edSpot=$("<div/>").addClass(a).css("position","absolute").css("left",b).css("top",c).data("spotObj",this).appendTo(Editor.$edDiv),"invisible-spot"===a&&this.$edSpot.addClass("invisible-spot-ed"),"onhover-spot"===a&&this.$edSpot.addClass("onhover-spot-ed");if(this.$hsWrap=$("<div/>").addClass("hs-wrap"),this.$ttWrap=$("<div/>").addClass("tt-wrap"),this.$prevSpot=$("<div/>").addClass(a).appendTo(this.$hsWrap),this.$tooltip=$("<div/>").appendTo(this.$ttWrap),this.$ttWrap.appendTo(this.$hsWrap),Editor.$prevDiv.append(this.$hsWrap),"img-spot"===a){var e=$("<img/>");this.$edSpot.append(e).append("<img/>"),e.show(),this.$prevSpot.append("<img/>").append("<img/>")}this.coord=[b,c],this.dim="sniper-spot"===a||"img-spot"===a?null:[0,0,0],this.spLink="",this.spLinknWin=!1,this.ttContent="",this.options={spType:"General",spAnim:!0,spActiveon:"hover",spName:"",ttType:"tip",ttAnim:"goin",ttDir:"top",ttWidth:"",ttPos:"",ttColor:"black"},"sniper-spot"===this.spotClass&&(this.options.ttPos=-18)};Spot.prototype.flushOptions=function(){this.$hsWrap.removeAttr("style"),this.$prevSpot.removeAttr("style"),this.$prevSpot.attr("class",this.spotClass),this.$ttWrap.attr("class","tt-wrap"),this.$ttWrap.removeAttr("style"),this.$tooltip.removeAttr("style").removeData(),this.$prevSpot.attr("data-coord",this.coord.join(",")),null!==this.dim&&this.$prevSpot.attr("data-dim",this.dim.join(",")),"Aim"===this.options.spType?(this.$prevSpot.attr("data-handler","Aim"),this.options.spAnim===!1?this.$prevSpot.attr("data-handleropts",this.options.spAnim):this.$prevSpot.removeAttr("data-handleropts")):(this.$prevSpot.removeAttr("data-handler"),this.$prevSpot.removeAttr("data-handleropts")),this.$prevSpot.attr("data-activeon",this.options.spActiveon),this.options.spName?this.$prevSpot.attr("data-name",$.trim(this.options.spName)):this.$prevSpot.removeAttr("data-name");var a,b=this.$prevSpot.parent();if(this.spLink?(a=b[0]!==this.$hsWrap[0]?b.attr("href",this.spLink):$("<a/>").attr("href",this.spLink).prependTo(this.$hsWrap).append(this.$prevSpot),this.spLinknWin?a.attr("target","_blank"):a.removeAttr("target")):b[0]!==this.$hsWrap[0]&&(this.$prevSpot.prependTo(this.$hsWrap),b.remove()),this.$tooltip.removeClass(),"Aim"===this.options.spType?this.$tooltip.addClass("aim-tooltip"):this.$tooltip.addClass(this.options.ttType+"-tooltip"),this.options.ttAnim&&"none"!==this.options.ttAnim?this.$tooltip.attr("data-anim",this.options.ttAnim):this.$tooltip.removeAttr("data-anim"),this.options.ttDir?this.$tooltip.attr("data-dir",this.options.ttDir):this.$tooltip.removeAttr("data-dir"),this.options.ttWidth?this.$tooltip.attr("data-width",parseInt(this.options.ttWidth)):this.$tooltip.removeAttr("data-width"),this.options.ttPos?this.$tooltip.attr("data-pos",parseInt(this.options.ttPos)):this.$tooltip.removeAttr("data-pos"),"white"===this.options.ttColor&&this.$tooltip.addClass(this.options.ttColor),this.ttContent?"Aim"===this.options.spType?(this.$tooltip.html(""),$("<div/>").addClass("tt-content").html(this.ttContent).appendTo(this.$tooltip)):this.$tooltip.html(this.ttContent):this.$tooltip.html(""),"img-spot"===this.spotClass){var c=this.$edSpot.find("img").eq(0),d=this.$edSpot.find("img").eq(1),e=this.$prevSpot.find("img").eq(0),f=this.$prevSpot.find("img").eq(1);this.$prevSpot.find("img").removeAttr("style"),c.width()&&(e.attr("width",c.width()),e.attr("height",c.height())),d.width()&&(f.attr("width",d.width()),f.attr("height",d.height()))}},Spot.prototype.select=function(){if("glass-spot"===this.spotClass||"shadow-spot"===this.spotClass){var a=this.$edSpot.width(),b=this.$edSpot.height();this.$edSpot.width(a-4),this.$edSpot.height(b-4)}if("img-spot"===this.spotClass){var c=this.$edSpot.find("> img").eq(0),d=this.$edSpot.position().left,e=c.width(),f=this.$edSpot.position().top,g=c.height(),h=Editor.$edImg.width(),i=Editor.$edImg.height();Math.round(d+e)===h&&this.$edSpot.css("left",d-4),Math.round(f+g)===i&&this.$edSpot.css("top",f-4)}this.$edSpot.addClass("selected")},Spot.prototype.unselect=function(){if("glass-spot"===this.spotClass||"shadow-spot"===this.spotClass){var a=this.$edSpot.width(),b=this.$edSpot.height();this.$edSpot.width(a+4),this.$edSpot.height(b+4)}if("img-spot"===this.spotClass){var c=this.$edSpot.find("> img").eq(0),d=this.$edSpot.position().left,e=c.width(),f=this.$edSpot.position().top,g=c.height(),h=Editor.$edImg.width(),i=Editor.$edImg.height();Math.round(d+e+4)===h&&(this.$edSpot.css("left",d+4),Editor.updateSpotPos()),Math.round(f+g+4)===i&&(this.$edSpot.css("top",f+4),Editor.updateSpotPos())}this.$edSpot.removeClass("selected")},Spot.prototype.del=function(){this.$edSpot.remove(),this.$hsWrap.remove()};var Editor={isPreview:!1,$edDiv:null,$prevDiv:null,$edImg:null,$prevImg:null,curSpot:null,optionBar:{},spotPool:[],init:function(){this.$edDiv=$(".edit-area"),this.$prevDiv=$(".hs-area"),this.$edImg=$("#ed-img"),this.$prevImg=$("#prev-img"),this.isLocalFile=!1,this.localFile=null,this.$optionFrm=$("#option-frm"),this.optionBar.spType=$("#sp-type"),this.optionBar.spAnim=$("#sp-anim"),this.optionBar.spActiveon=$("#sp-activeon"),this.optionBar.spBradius=$("#sp-bradius"),this.optionBar.spName=$("#sp-name"),this.optionBar.ttType=$("#tt-type"),this.optionBar.ttAnim=$("#tt-anim"),this.optionBar.ttDir=$("#tt-dir"),this.optionBar.ttWidth=$("#tt-width"),this.optionBar.ttPos=$("#tt-pos"),this.optionBar.ttColor=$("#tt-color"),$("#nimg-btn").bind("click",function(){$("#new-img-dialog").dialog("open")}),$("#prev-btn , #end-prev-btn").bind("click",$.proxy(Editor.togglePreview,Editor)),$("#gcode-btn").bind("click",$.proxy(Editor.getCode,Editor)),$("#load-code-btn").bind("click",function(){$("#load-code-dialog").dialog("open")}),this.bindHotKeys(),$(".spot-bar button").bind("click",function(){Draw.type=$(this).attr("id").slice(0,-4),Editor.focusSpotBtn(Draw.type)}),$("#clone-btn").bind("click",$.proxy(Editor.cloneSpot,Editor)),$("#del-btn").bind("click",$.proxy(Editor.delSpot,Editor)),$("#link-btn").bind("click",function(){$("#sp-link-dialog").dialog("open")}),this.$optionFrm.bind("change",$.proxy(Editor.optionChange,Editor)),this.$optionFrm.bind("submit",function(a){a.preventDefault()}),$("#tt-content-btn").bind("click",function(){$("#tt-content").val(Editor.curSpot.ttContent),$("#tt-content-dialog").dialog("open")}),window.File&&window.FileList&&window.FileReader||$(".html5-local-file").hide(),$("#new-i-d-tabs").tabs(),$("#new-img-dialog").dialog({autoOpen:!1,modal:!0,title:"New Image",resizable:!1,show:"drop",hide:"drop",buttons:{Open:$.proxy(Editor.newImage,Editor),Cancel:function(){$(this).dialog("close")}},open:function(){$("#img-url-txt , #img-file-txt").val("")},close:function(){Editor.$edDiv.focus()}}),$("#img-file-txt").bind("change",function(a){Editor.localFile=a.target.files[0]}),$("#gcode-dialog").dialog({autoOpen:!1,modal:!0,title:"Get code",resizable:!1,width:630,show:"drop",hide:"drop",buttons:{OK:function(){$(this).dialog("close")}},close:function(){$("#gcode-txt").val(""),$(this).find(".ui-widget").hide(),Editor.$edDiv.focus()}}),$("#load-code-dialog").dialog({autoOpen:!1,modal:!0,title:"Load code",resizable:!1,width:630,show:"drop",hide:"drop",buttons:{Load:function(){Editor.loadCode(),$(this).dialog("close")},Close:function(){$(this).dialog("close")}},close:function(){Editor.$edDiv.focus()}}),$("#gcode-txt").bind("focus",function(){var a=$(this);a.select(),a.bind("mouseup",function(){return a.unbind("mouseup"),!1})}),$("#img-spot-dialog").dialog({autoOpen:!1,modal:!0,title:"Choose Images",resizable:!1,width:380,height:200,show:"drop",hide:"drop",buttons:{Save:$.proxy(Editor.imgSpotSave,Editor),Cancel:function(){$(this).dialog("close")}},close:function(){Editor.curSpot.$edSpot.data("img-spot-save")||Editor.delSpot(),$("#imgspot-1 , #imgspot-2").val(""),Editor.$edDiv.focus()}}),$("#sp-link-dialog").dialog({autoOpen:!1,modal:!0,title:"Spot Link",resizable:!1,show:"drop",hide:"drop",buttons:{Save:function(){Editor.curSpot.spLink=$("#sp-link").val(),Editor.curSpot.spLinknWin=$("#sp-link-n-win").is(":checked"),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},open:function(){$("#sp-link").val(Editor.curSpot.spLink),Editor.curSpot.spLinknWin?$("#sp-link-n-win").prop("checked",!0):$("#sp-link-n-win").prop("checked",!1)},close:function(){Editor.$edDiv.focus()}}),$("#tt-content-dialog").dialog({autoOpen:!1,modal:!0,resizable:!1,width:430,title:"Tooltip Content",show:"drop",hide:"drop",buttons:{Save:$.proxy(Editor.ttContentSave,Editor),Cancel:function(){$(this).dialog("close")}},open:function(){$("#tt-content").val(Editor.curSpot.ttContent)},close:function(){Editor.$edDiv.focus()}}),$("#error-dialog").dialog({autoOpen:!1,modal:!0,title:"Error",resizable:!1,draggable:!1,show:"shake",hide:"fade",buttons:{OK:function(){$(this).dialog("close")}}}),$("button").button(),$("#sp-bradius").spinner({create:function(){$(this).parent().removeClass("ui-widget-content")},stop:function(){Editor.curSpot.$edSpot.css("border-radius",parseInt($("#sp-bradius").val()))}}),$(document).tooltip({position:{my:"center top",at:"left bottom+10",using:function(a){$(this).css(a),$(this).css("font-size","12px")}}})},newImage:function(){var a=$("#img-url-txt").val();return a||Editor.localFile?("block"===$("#img-url").css("display")?(Editor.initNewImage(a),Editor.isLocalFile=!1):this.localFile&&(Editor.initNewImage(Editor.localFile),Editor.isLocalFile=!0),$("#new-img-dialog").dialog("close"),void 0):(this.showError("Choose Image"),void 0)},initNewImage:function(a){if(Editor.spotPool.length>0){var b=Editor.spotPool.length-1;do Editor.spotPool[b].del(),delete Editor.spotPool[b];while(b--);Editor.spotPool=[]}if(this.$edImg.removeAttr("src"),"string"==typeof a)this.$edImg.attr("src",a),this.$prevImg.attr("src",a);else{var c=new FileReader;c.onload=function(a){Editor.$edImg.attr("src",a.target.result),Editor.$prevImg.attr("src",a.target.result)},c.readAsDataURL(a)}Draw.init(Editor.$edImg),Editor.$prevImg.removeAttr("data-imgdim"),$(".img-resp-container").show(),$(".spot-options").hide(),Editor.focusSpotBtn("red-spot"),Draw.type="red-spot"},togglePreview:function(){if(this.inPreview){this.inPreview=!1,$("#end-prev-btn").hide(),window.location.hash="",$(window).unbind(".hotspotter");var a,b=this.spotPool.length-1;do a=this.spotPool[b],a.$prevSpot.removeData(),"Aim"===a.options.spType&&(a.$tooltip.appendTo(Editor.spotPool[b].$ttWrap),a.$tooltip.stop(),a.$prevSpot.parents(".hs-area").removeData().find(".hs-aim-rect , .hs-aim-pillar").remove(),a.$hsWrap.unbind());while(b--);$("#prev-overlay").hide(),this.$prevDiv.parent().hide(),Editor.$edDiv.focus()}else{if(0===this.spotPool.length)return this.showError("There is no spots"),void 0;if(this.inPreview=!0,$("#end-prev-btn").show(),this.curSpot&&"img-spot"===this.curSpot.spotClass){var c=this.curSpot.$edSpot.find("> img").eq(0),d=this.curSpot.$edSpot.position().left,e=c.width(),f=this.curSpot.$edSpot.position().top,g=c.height(),h=Editor.$edImg.width(),i=Editor.$edImg.height();Math.round(d+e+4)===h&&(this.curSpot.coord[0]=d+4),Math.round(f+g+4)===i&&(this.curSpot.coord[1]=f+4)}this.curSpot&&this._saveOptions();var b=this.spotPool.length-1;do this.spotPool[b].flushOptions();while(b--);var j=$(window).width(),k=$(window).height(),l=this.$prevDiv.parent().width(),m=this.$prevDiv.parent().height(),n=0,o=45;j>l&&(n=(j-l)/2),k>m+90&&(o=(k-m)/2),this.$prevDiv.parent().css("left",n),this.$prevDiv.parent().css("top",o),$("#prev-overlay").show(),this.$prevDiv.parent().show(),this.$prevDiv.hotspotter()}},getCode:function(){if(!this.spotPool.length)return this.showError("There is no spots"),void 0;var a=220;if($("#img-responsive").is(":checked")){var b=this.$edImg.width(),c=this.$edImg.height();this.$prevImg.attr("data-imgdim",[b,c].join(","))}else this.$prevImg.removeAttr("data-imgdim");this.$prevImg.removeAttr("id"),this.curSpot&&this._saveOptions();var d=this.spotPool.length-1;do this.spotPool[d].flushOptions();while(d--);if(this.curSpot&&"img-spot"===this.curSpot.spotClass){var e=this.curSpot.$edSpot.find("> img").eq(0),f=this.curSpot.$edSpot.position().left,g=e.width(),h=this.curSpot.$edSpot.position().top,i=e.height(),j=Editor.$edImg.width(),k=Editor.$edImg.height();Math.round(f+g+4)===j&&(this.curSpot.coord[0]=f+4),Math.round(h+i+4)===k&&(this.curSpot.coord[1]=h+4)}var l;if(this.isLocalFile){var m=this.$prevImg.attr("src");$("#local-file-notice").show(),this.$prevImg.attr("src","your image URL"),l=this.$prevDiv.parent().html(),this.$prevImg.attr("src",m),a=320}else $("#local-file-notice").hide(),l=this.$prevDiv.parent().html();l=style_html(l),$("#gcode-txt").val(l),$("#gcode-dialog").dialog("option").height=a,$("#gcode-dialog").dialog("open")},loadCode:function(){var a=$($("#load-code-txt").val()),b=a.filter(".hs-area").eq(0),c=b.find("> img");return b.length?(Editor.initNewImage(c.attr("src")),c.attr("data-imgdim")&&$("#img-responsive").prop("checked",!0),b.find(".hs-wrap").each(function(){var a,b=$(this),c=b.find("div[data-coord]"),d=b.find(".tt-wrap > div"),e=c.attr("class"),f=c.attr("data-coord").split(","),g=c.attr("data-dim"),h=c.attr("data-activeon"),i=c.attr("data-handler"),j=c.attr("data-handleropts"),k=c.attr("data-name"),l=d.attr("data-width"),m=d.attr("data-dir"),n=d.attr("data-anim"),o=d.attr("data-pos");if(a=new Spot(e,f[0],f[1]),a.$edSpot.css("left",f[0]+"px"),a.$edSpot.css("top",f[1]+"px"),"img-spot"===e){var p=c.find("> img").eq(0).attr("src"),q=c.find("> img").eq(1).attr("src");Editor.loadImgSpot(a,p,q)}if(g){var r=g.split(",");a.dim=[r[0],r[1],r[2]],a.$edSpot.width(r[0]),a.$edSpot.height(r[1]),r[2]&&a.$edSpot.css("border-radius",r[2]+"px")}a.options.spActiveon=h,a.options.spType=i||"General",a.options.spAnim=!!j;var s=c.parent();s.is("a")&&(a.spLink=s.attr("href"),s.attr("target")&&(a.spLinknWin=!0)),a.options.spName=k,d.hasClass("tip-tooltip")?a.options.ttType="tip":d.hasClass("bubble-tooltip")?a.options.ttType="bubble":d.hasClass("aim-tooltip")&&(a.options.ttType="aim"),a.ttContent="aim"===a.options.ttType?d.find(".tt-content").html():d.html(),a.options.ttWidth=l||"",a.options.ttDir=m||"top",a.options.ttAnim=n||"goin",a.options.ttPos=o||"",a.options.ttColor=d.hasClass("white")?"white":"black",Editor.spotPool.push(a),a.$edSpot.bind("mousedown",function(){Editor.toggleSelect($(this).data("spotObj"))}),"sniper-spot"!==a.spotClass&&"img-spot"!==a.spotClass&&a.$edSpot.resizable({containment:Editor.$edImg,stop:$.proxy(Editor.updateSpotDim,Editor)}),a.$edSpot.draggable({containment:Editor.$edImg,stop:$.proxy(Editor.updateSpotPos,Editor)})}),void 0):(Editor.showError("There's no div Tag with class .hs-area"),void 0)},delSpot:function(){if(this.curSpot){this.curSpot.del();var a=this.spotPool.length-1;do if(this.spotPool[a]===this.curSpot){this.spotPool.splice(a,1),delete this.curSpot;break}while(a--);this.curSpot=null,this.hideOptionBar()}},cloneSpot:function(){if(this.curSpot){var a={w:this.$edImg.width(),h:this.$edImg.height()},b={w:this.curSpot.$edSpot.width(),h:this.curSpot.$edSpot.height()},c={x:parseFloat(this.curSpot.$edSpot.css("left")),y:parseFloat(this.curSpot.$edSpot.css("top"))},d={};this._saveOptions(),d.x=c.x+b.w+10<a.w?c.x+10:c.x-10,d.y=c.y+b.h+10<a.h?c.y+10:c.y-10;var e=new Spot(this.curSpot.spotClass,d.x,d.y);if(e.options=$.extend({},this.curSpot.options),"sniper-spot"!==this.curSpot.spotClass&&"img-spot"!==this.curSpot.spotClass&&(e.$edSpot.width(b.w),e.$edSpot.height(b.h),e.dim=[b.w,b.h,this.curSpot.dim[2]],e.$edSpot.css("border-radius",this.curSpot.dim[2])),e.ttContent=this.curSpot.ttContent,e.spLink=this.curSpot.spLink,e.spLinknWin=this.curSpot.spLinknWin,"img-spot"===this.curSpot.spotClass){var f=this.curSpot.$edSpot.find("img").eq(0).attr("src"),g=this.curSpot.$edSpot.find("img").eq(1).attr("src");e.$edSpot.find("img").eq(0).attr("src",f),e.$prevSpot.find("img").eq(0).attr("src",f),e.$edSpot.find("img").eq(1).attr("src",g),e.$prevSpot.find("img").eq(1).attr("src",g)}this.newSpot(e)}},imgSpotSave:function(){var a=$("#imgspot-1").val(),b=$("#imgspot-2").val();return Editor.loadImgSpot(Editor.curSpot,a,b,!1)?($("#imgspot-1").val(""),$("#imgspot-2").val(""),Editor.curSpot.$edSpot.data("img-spot-save",!0),$("#img-spot-dialog").dialog("close"),void 0):(this.showError("One of images or both are not set"),void 0)},loadImgSpot:function(a,b,c,d){var e=a.$edSpot.find("img").eq(0);return b&&c?(e.attr("src",b),a.$edSpot.find("img").eq(1).attr("src",c),a.$prevSpot.find("img").eq(0).attr("src",b),a.$prevSpot.find("img").eq(1).attr("src",c),d||(e.bind("load.boundaryCheck",function(){var b=$(this),c=a.$edSpot.position().left,d=b.width(),e=a.$edSpot.position().top,f=b.height(),g=Editor.$edImg.width(),h=Editor.$edImg.height();if(c+d+4>g){var i=parseFloat(a.$edSpot.css("left")),j=parseFloat(a.$edSpot.css("top"));a.$edSpot.css("left",g-d-4),a.coord=[i,j]}if(e+f+4>h){var i=parseFloat(a.$edSpot.css("left")),j=parseFloat(a.$edSpot.css("top"));a.$edSpot.css("top",h-f-4),a.coord=[i,j]}}),e[0].complete&&e.trigger("load.boundaryCheck")),!0):!1},ttContentSave:function(){this.curSpot.ttContent=$("#tt-content").val(),$("#tt-content-dialog").dialog("close")},showError:function(a){$("#error-txt").text(a),$("#error-dialog").dialog("open")},focusSpotBtn:function(a){$(".spot-bar button").removeClass("btn-focus"),$("#"+a+"-btn").addClass("btn-focus")},newSpot:function(a){this.spotPool.push(a),a.$edSpot.bind("mousedown",function(){Editor.toggleSelect($(this).data("spotObj"))}),"sniper-spot"!==a.spotClass&&"img-spot"!==a.spotClass&&a.$edSpot.resizable({containment:Editor.$edImg,stop:$.proxy(Editor.updateSpotDim,Editor)}),a.$edSpot.draggable({containment:Editor.$edImg,stop:$.proxy(Editor.updateSpotPos,Editor)}),this.toggleSelect(a)},toggleSelect:function(a){this.curSpot&&(this._saveOptions(),this.curSpot.unselect()),this.curSpot=a,a.select(),this._updateOptions(),this.adjustOptionsBar(),this.showOptionBar()},_updateOptions:function(){var a=this.curSpot.options;for(var b in this.optionBar)"spBradius"!==b?null!==a[b]&&("spAnim"!==b?this.optionBar[b].val(a[b]):this.optionBar.spAnim.prop("checked",a.spAnim)):this.curSpot.dim&&this.optionBar.spBradius.val(this.curSpot.dim[2]);$("#sp-link").val(this.curSpot.spLink),this.curSpot.spLinknWin?$("#sp-link-n-win").prop("checked",!0):$("#sp-link-n-win").prop("checked",!1)},_saveOptions:function(){var a=this.curSpot.options;for(var b in this.optionBar)"spBradius"!==b?a[b]=this.isEnabled(b)?"spAnim"!==b?this.optionBar[b].val():this.optionBar[b].is(":checked"):null:this.isEnabled("spBradius")&&(this.curSpot.dim[2]=parseInt(this.optionBar.spBradius.val(),10))},updateSpotDim:function(){var a=this.curSpot.$edSpot.outerWidth(),b=this.curSpot.$edSpot.outerHeight();"glass-spot"===this.curSpot.spotClass||"shadow-spot"===this.curSpot.spotClass?(a=this.curSpot.$edSpot.outerWidth(),b=this.curSpot.$edSpot.outerHeight()):(a=this.curSpot.$edSpot.width(),b=this.curSpot.$edSpot.height()),this.curSpot.dim[0]=a,this.curSpot.dim[1]=b},updateSpotPos:function(){var a=parseFloat(this.curSpot.$edSpot.css("left")),b=parseFloat(this.curSpot.$edSpot.css("top"));this.curSpot.coord=[a,b]},_enableOption:function(a){this.optionBar[a].parents("tr").css("display","")},_disableOption:function(a){this.optionBar[a].parents("tr").css("display","none")},isEnabled:function(a){return"none"===this.optionBar[a].parents("tr").css("display")?!1:!0},showOptionBar:function(){$(".spot-options").show()},hideOptionBar:function(){$(".spot-options").hide()},adjustOptionsBar:function(){"General"===this.optionBar.spType.val()&&(this._disableOption("spAnim"),this._enableOption("ttType"),this._enableOption("ttAnim"),this._enableOption("ttWidth"),this._enableOption("ttPos"),"tip"===this.optionBar.ttType.val()?(this._enableOption("ttDir"),this._enableOption("ttColor")):(this._disableOption("ttDir"),this._disableOption("ttColor"))),"Aim"===this.optionBar.spType.val()&&(this._enableOption("spAnim"),this._disableOption("ttType"),this._disableOption("ttAnim"),this._enableOption("ttDir"),"right"===this.optionBar.ttDir.val()||"left"===this.optionBar.ttDir.val()?this._enableOption("ttWidth"):this._disableOption("ttWidth"),this._disableOption("ttPos"),this._disableOption("ttColor")),"sniper-spot"===this.curSpot.spotClass||"img-spot"===this.curSpot.spotClass||"invisible-spot"===this.curSpot.spotClass?this._disableOption("spBradius"):this._enableOption("spBradius"),"invisible-spot"===this.curSpot.spotClass||"onhover-spot"===this.curSpot.spotClass?this.optionBar.spActiveon.find("option").eq(1).attr("disabled",""):this.optionBar.spActiveon.find("option").eq(1).removeAttr("disabled")},optionChange:function(){this.adjustOptionsBar(),this._saveOptions()},bindHotKeys:function(){$(document).delegate(".ui-dialog","keyup",function(a){var b=a.target.tagName.toLowerCase();return b="input"===b&&"button"===a.target.type?"button":b,a.which===$.ui.keyCode.ENTER&&"textarea"!==b&&"select"!==b&&"button"!==b?($(this).find("button").eq(0).trigger("click"),!1):void 0}),$(document).bind("keydown",function(a){a.ctrlKey&&a.altKey&&Editor.togglePreview()}),Editor.$edDiv.bind("click",function(){$(this).focus()}),Editor.$edDiv.bind("keydown",function(a){if(Editor.curSpot){var b;switch(a.which){case $.ui.keyCode.UP:b=parseFloat(Editor.curSpot.$edSpot.css("top")),b>0&&(Editor.curSpot.$edSpot.css("top",b-1),Editor.updateSpotPos()),a.preventDefault();break;case $.ui.keyCode.DOWN:var c,d;b=parseFloat(Editor.curSpot.$edSpot.css("top")),c=Editor.$edImg.height(),d=Editor.curSpot.$edSpot.outerHeight(),c>b+d&&(Editor.curSpot.$edSpot.css("top",b+1),Editor.updateSpotPos()),a.preventDefault();break;case $.ui.keyCode.RIGHT:var e,f;b=parseFloat(Editor.curSpot.$edSpot.css("left")),e=Editor.$edImg.width(),f=Editor.curSpot.$edSpot.outerWidth(),e>b+f&&(Editor.curSpot.$edSpot.css("left",b+1),Editor.updateSpotPos()),a.preventDefault();break;case $.ui.keyCode.LEFT:b=parseFloat(Editor.curSpot.$edSpot.css("left")),b>0&&(Editor.curSpot.$edSpot.css("left",b-1),Editor.updateSpotPos()),a.preventDefault()}}}),Editor.$edDiv.bind("keyup",function(a){a.which===$.ui.keyCode.DELETE&&Editor.curSpot&&(Editor.delSpot(),a.preventDefault()),a.ctrlKey&&67===a.which&&Editor.curSpot&&(Editor.cloneSpot(),a.preventDefault())})}};Editor.init();